<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Gentoo protip: using buildpkgonly - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.siphos.be/2013/04/gentoo-protip-using-buildpkgonly/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="keywords" content="binpkg,emerge,Gentoo,protip" />
        <meta name="description" content="If you don&#39;t want to have the majority of builds run in the background while you are busy on the system, but you don&#39;t want to automatically install software in the background when you are not behind your desk, then perhaps you can settle for using binary packages. I&#39;m not …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Gentoo protip: using buildpkgonly"/>
        <meta property="og:url" content="http://blog.siphos.be/2013/04/gentoo-protip-using-buildpkgonly/"/>
        <meta property="og:description" content="If you don&#39;t want to have the majority of builds run in the background while you are busy on the system, but you don&#39;t want to automatically install software in the background when you are not behind your desk, then perhaps you can settle for using binary packages. I&#39;m not …"/>
        <meta property="article:published_time" content="2013-04-25" />
            <meta property="article:section" content="Gentoo" />
            <meta property="article:tag" content="binpkg" />
            <meta property="article:tag" content="emerge" />
            <meta property="article:tag" content="Gentoo" />
            <meta property="article:tag" content="protip" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="http://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="http://blog.siphos.be/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>



        <link href="http://blog.siphos.be/feeds/gentoo.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... Gentoo ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.siphos.be/2013/04/gentoo-protip-using-buildpkgonly/"
                       rel="bookmark"
                       title="Permalink to Gentoo protip: using buildpkgonly">
                        Gentoo protip: using buildpkgonly
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-04-25T03:50:00+02:00"> Thu 25 April 2013</time>
    </span>


            <span class="label label-default">By</span>
            <a href="http://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="http://blog.siphos.be/category/gentoo.html">Gentoo</a>


<span class="label label-default">Tags</span>
	<a href="http://blog.siphos.be/tag/binpkg/">binpkg</a>
        /
	<a href="http://blog.siphos.be/tag/emerge/">emerge</a>
        /
	<a href="http://blog.siphos.be/tag/gentoo/">Gentoo</a>
        /
	<a href="http://blog.siphos.be/tag/protip/">protip</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>If you don't want to have the majority of builds run in the background
while you are busy on the system, but you don't want to automatically
install software in the background when you are not behind your desk,
then perhaps you can settle for using <a href="https://wiki.gentoo.org/wiki/Binary_package_guide">binary
packages</a>. I'm not
saying you need to setup a build server and such or do your updates
first in a chroot.</p>
<p>No, what this tip is for is to use the <em>--buildpkgonly</em> parameter of
<strong>emerge</strong> at night, building some of your software (often the larger
ones) as binary packages only (storing those in the <code>${PKGDIR}</code> which
defaults to <code>/usr/portage/packages</code>). When you are then on your system,
you can run the update with binary package included:</p>
<div class="highlight"><pre><span></span><code># emerge -puDk world
</code></pre></div>


<p>To use <em>--buildpkgonly</em>, all package(s) that Portage wants to build must
have all their dependencies met. If not, then the build will not go
through and you're left with no binary packages at all. So what we do is
to create a script that looks at the set of packages that would be
build, and then one for one building the binary package.</p>
<p>When ran, the script will attempt to build binary packages for those
that have no dependency requirements anymore. Those builds will then
create a binary package but will not be merged on the system. When you
later update your system, including binary packages, those packages that
have been build during the night will be merged quickly, reducing the
build load on your system while you are working on it.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="ch">#!/bin/sh</span>

<span class="nv">LIST</span><span class="o">=</span><span class="k">$(</span>mktemp<span class="k">)</span><span class="p">;</span>

emerge -puDN --color<span class="o">=</span>n --columns --quiet<span class="o">=</span>y world <span class="p">|</span> awk <span class="s1">&#39;{print $2}&#39;</span> &gt; <span class="si">${</span><span class="nv">LIST</span><span class="si">}</span><span class="p">;</span>

<span class="k">for</span> PACKAGE in <span class="k">$(</span>cat <span class="si">${</span><span class="nv">LIST</span><span class="si">}</span><span class="k">)</span><span class="p">;</span>
<span class="k">do</span>
  <span class="nb">printf</span> <span class="s2">&quot;Building binary package for </span><span class="si">${</span><span class="nv">PACKAGE</span><span class="si">}</span><span class="s2">... &quot;</span>
  emerge -uN --quiet-build --quiet<span class="o">=</span>y --buildpkgonly <span class="si">${</span><span class="nv">PACKAGE</span><span class="si">}</span><span class="p">;</span>
  <span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> -eq <span class="m">0</span> <span class="o">]]</span><span class="p">;</span>
  <span class="k">then</span>
    <span class="nb">echo</span> <span class="s2">&quot;ok&quot;</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="nb">echo</span> <span class="s2">&quot;failed&quot;</span><span class="p">;</span>
  <span class="k">fi</span>
<span class="k">done</span>
</code></pre></div>
</td></tr></table>

<p>I ran this a couple of days ago when <em>-uDN world</em> showed 46 package
updates (including a few hefty ones like chromium). After running this
script, 35 of them had a binary package ready so the <em>-uDN world</em> now
only needed to build 11 packages, merging the remainder from binary
packages.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'gentoo-protip-using-buildpkgonly';
                var disqus_url = 'http://blog.siphos.be/2013/04/gentoo-protip-using-buildpkgonly/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>