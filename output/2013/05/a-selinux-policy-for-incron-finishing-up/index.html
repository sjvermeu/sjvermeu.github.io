<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>A SELinux policy for incron: finishing up - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.siphos.be/2013/05/a-selinux-policy-for-incron-finishing-up/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="keywords" content="incron,policy,selinux" />
        <meta name="description" content="After 9 posts, it&#39;s time to wrap things up. You can review the final results online (incron.te, incron.if and incron.fc) and adapt to your own needs if you want. But we should also review what we have accomplished so far... We built the start of an entire …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="A SELinux policy for incron: finishing up"/>
        <meta property="og:url" content="http://blog.siphos.be/2013/05/a-selinux-policy-for-incron-finishing-up/"/>
        <meta property="og:description" content="After 9 posts, it&#39;s time to wrap things up. You can review the final results online (incron.te, incron.if and incron.fc) and adapt to your own needs if you want. But we should also review what we have accomplished so far... We built the start of an entire …"/>
        <meta property="article:published_time" content="2013-05-31" />
            <meta property="article:section" content="SELinux" />
            <meta property="article:tag" content="incron" />
            <meta property="article:tag" content="policy" />
            <meta property="article:tag" content="selinux" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="http://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="http://blog.siphos.be/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>



        <link href="http://blog.siphos.be/feeds/selinux.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... SELinux ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.siphos.be/2013/05/a-selinux-policy-for-incron-finishing-up/"
                       rel="bookmark"
                       title="Permalink to A SELinux policy for incron: finishing up">
                        A SELinux policy for incron: finishing up
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-05-31T03:50:00+02:00"> Fri 31 May 2013</time>
    </span>


            <span class="label label-default">By</span>
            <a href="http://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="http://blog.siphos.be/category/selinux.html">SELinux</a>


<span class="label label-default">Tags</span>
	<a href="http://blog.siphos.be/tag/incron/">incron</a>
        /
	<a href="http://blog.siphos.be/tag/policy/">policy</a>
        /
	<a href="http://blog.siphos.be/tag/selinux/">selinux</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>After 9 posts, it's time to wrap things up. You can review the final
results online
(<a href="http://dev.gentoo.org/~swift/blog/01/incron.te.txt">incron.te</a>,
<a href="http://dev.gentoo.org/~swift/blog/01/incron.if.txt">incron.if</a> and
<a href="http://dev.gentoo.org/~swift/blog/01/incron.fc.txt">incron.fc</a>) and
adapt to your own needs if you want. But we should also review what we
have accomplished so far...</p>
<p>We built the start of an entire policy for a daemon (the inotify cron
daemon) for two main types: the daemon itself, and its management
application <strong>incrontab</strong>. We defined new types and contexts, we used
attributes, declared a boolean and worked with interfaces. That's a lot
to digest, and yet it is only a part of the various capabilities that
SELinux offers.</p>
<p>The policy isn't complete though. We defined a type called
<code>incron_initrc_exec_t</code> but don't really use it further. In practice, we
would need to define an additional interface (probably named
<em>incron_admin</em>) that allows users and roles to manage <em>incron</em> without
needing to grant this user/role <code>sysadm_r</code> privileges. I leave that up
to you as an exercise for now, but I'll post more about admin interfaces
and how to work with them on a system in the near future.</p>
<p>We also made a few assumptions and decisions while building the policy
that might not be how you yourself would want to build the policy.
SELinux is a MAC system, but the policy language is very flexible. You
can use an entirely different approach in policies if you want. For
instance, <em>incron</em> supports launching the <strong>incrond</strong> as a command-line,
foreground process. This could help users run <strong>incrond</strong> under their
privileges for their own files - we did not consider this case in our
design. Although most policies try to capture all use cases of an
application, there will be cases when a policy developer did either not
consider the use case or found that it infringed with his own principles
on policy development (and allowed activities on a system).</p>
<p>In Gentoo Hardened, I try to write down the principles and policies that
we follow in a <a href="http://www.gentoo.org/proj/en/hardened/selinux-policy.xml">Gentoo Hardened SELinux Development
Policy</a>
document. As decisions need to be taken, such a document might help find
common consensus on how to approach SELinux policy development further,
and I seriously recommend that you consider writing up a similar
document yourself, especially if you are going to develop policies for a
larger organization.</p>
<p>One of the deficiencies of the current policy is that it worked with the
unmodified <em>incron</em> version. If we would patch <em>incron</em> so that it could
change context on executing the incrontab files of a user, then we can
start making use of the default context approach (and perhaps even
enhance with PAM services). In that case, user incrontabs could be
launched entirely from the users' context (like <code>user_u:user_r:user_t</code>)
instead of the <code>system_u:system_r:incrond_t</code> or transitioned
<code>system_u:system_r:whatever_t</code> contexts. Having user provided commands
executed in the system context is a security risk, so in our policy we
would <em>not</em> grant the <em>incron_role</em> to untrusted users - probably only
to <code>sysadm_t</code> and even then he probably would be better with using the
<code>/etc/incron.d</code> anyway.</p>
<p>The downside of patching code however is that this is only viable if
upstream wants to support this - otherwise we would need to maintain the
patches ourselves for a long time, creating delays in releases (upstream
released a new version and we still need to reapply and refactor
patches) and removing precious (human) resources from other, Gentoo
Hardened/SELinux specific tasks (like bugfixing and documentation
writing ;-)</p>
<p>Still, the policy returned a fairly good view on how policies <em>can</em> be
developed. And as I said, there are still other things that weren't
discussed, such as:</p>
<ul>
<li>Build-time decisions, which can change policies based on build
    options of the policy. In the reference policy, this is most often
    used for distribution-specific choices: if Gentoo would use one
    approach and Redhat another, then the differences would be separated
    through <code>ifdef(`distro_gentoo',`...')</code> and
    <code>ifdef(`distro_redhat',`...')</code> calls.</li>
<li>Some calls might only be needed if another policy is loaded. I think
    all calls made currently are part of base modules, so can be
    expected to be available at all times. But if we would need
    something like <em>icecast_signal(incrond_t)</em>, then we would need to
    put that call inside a <code>optional_policy(`...')</code> statement.
    Otherwise, our policy would fail to load because the <em>icecast</em>
    SELinux policy isn't loaded.</li>
<li>We could even introduce specific statements like <em>dontaudit</em> or
    <em>neverallow</em> to fine-tune the policy. Note though that <em>neverallow</em>
    is a compile-time statement: it is not a way to negate <em>allow</em>
    rules: if there is one <em>allow</em> that would violate the <em>neverallow</em>,
    then that module just refuses to build.</li>
</ul>
<p>Furthermore, if you want to create policies to be pushed upstream to the
reference policy project, you will need to look into the
<a href="http://oss.tresys.com/projects/refpolicy/wiki/StyleGuide">StyleGuide</a>
and
<a href="http://oss.tresys.com/projects/refpolicy/wiki/InterfaceNaming">InterfaceNaming</a>
documents as those define the order that rules should be placed and the
name syntax for interfaces. I have been contributing a lot to the
reference policy and I still miss a few of these, so for me they are not
that obvious. But using a common style is important as it allows for
simple patching, code comparison and even allows us to easily read
through complex policies.</p>
<p>If you don't want to contribute it, but still use it on your Gentoo
system, you can use a simple ebuild to install the files. Create an
ebuild (for instance <code>selinux-incron</code>), put the three files in the
<code>files/</code> subdirectory, and use the following ebuild code:</p>
<div class="highlight"><pre><span></span><code># Copyright 1999-2013 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header$
EAPI=&quot;4&quot;

IUSE=&quot;&quot;
MODS=&quot;incron&quot;
BASEPOL=&quot;2.20130424-r1&quot;
POLICY_FILES=&quot;incron.te incron.fc incron.if&quot;

inherit selinux-policy-2

DESCRIPTION=&quot;SELinux policy for incron, the inotify cron daemon&quot;

KEYWORDS=&quot;~amd64 ~x86&quot;
</code></pre></div>


<p>When installed, the interface files will be published as well and can
then be used by other modules (something we couldn't do in the past few
posts) or by the <strong>selocal</strong> tool.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'a-selinux-policy-for-incron-finishing-up';
                var disqus_url = 'http://blog.siphos.be/2013/05/a-selinux-policy-for-incron-finishing-up/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>