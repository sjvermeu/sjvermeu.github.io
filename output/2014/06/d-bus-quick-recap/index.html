<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>D-Bus, quick recap - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.siphos.be/2014/06/d-bus-quick-recap/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="keywords" content="dbus,linux" />
        <meta name="description" content="I&#39;ve never fully investigated the what and how of D-Bus. I know it is some sort of IPC, but higher level than the POSIX IPC methods. After some reading, I think I start to understand how it works and how administrators can work with it. So a quick write-down is …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="D-Bus, quick recap"/>
        <meta property="og:url" content="http://blog.siphos.be/2014/06/d-bus-quick-recap/"/>
        <meta property="og:description" content="I&#39;ve never fully investigated the what and how of D-Bus. I know it is some sort of IPC, but higher level than the POSIX IPC methods. After some reading, I think I start to understand how it works and how administrators can work with it. So a quick write-down is …"/>
        <meta property="article:published_time" content="2014-06-29" />
            <meta property="article:section" content="Free Software" />
            <meta property="article:tag" content="dbus" />
            <meta property="article:tag" content="linux" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="http://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="http://blog.siphos.be/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>



        <link href="http://blog.siphos.be/feeds/free-software.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... Free Software ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.siphos.be/2014/06/d-bus-quick-recap/"
                       rel="bookmark"
                       title="Permalink to D-Bus, quick recap">
                        D-Bus, quick recap
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-06-29T19:16:00+02:00"> Sun 29 June 2014</time>
    </span>


            <span class="label label-default">By</span>
            <a href="http://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="http://blog.siphos.be/category/free-software.html">Free Software</a>


<span class="label label-default">Tags</span>
	<a href="http://blog.siphos.be/tag/dbus/">dbus</a>
        /
	<a href="http://blog.siphos.be/tag/linux/">linux</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>I've never fully investigated the what and how of D-Bus. I know it is
some sort of IPC, but higher level than the POSIX IPC methods. After
some reading, I think I start to understand how it works and how
administrators can work with it. So a quick write-down is in place so I
don't forget in the future.</p>
<p>There is one <em>system</em> bus and, for each X session of a user, also a
<em>session</em> bus.</p>
<p>A bus is governed by a <code>dbus-daemon</code> process. A bus itself has objects
on it, which are represented through path-like constructs (like
<code>/org/freedesktop/ConsoleKit</code>). These objects are provided by a service
(application). Applications "own" such services, and identify these
through a namespace-like value (such as <code>org.freedesktop.ConsoleKit</code>).<br>
Applications can send signals to the bus, or messages through methods
exposed by the service. If methods are invoked (i.e. messages send) then
the application must specify the interface (such as
<code>org.freedesktop.ConsoleKit.Manager.Stop</code>).</p>
<p>Administrators can monitor the bus through <strong>dbus-monitor</strong>, or send
messages through <strong>dbus-send</strong>. For instance, the following command
invokes the <code>org.freedesktop.ConsoleKit.Manager.Stop</code> method provided by
the object at <code>/org/freedesktop/ConsoleKit</code> owned by the
service/application at <code>org.freedesktop.ConsoleKit</code>:</p>
<div class="highlight"><pre><span></span><code>~$ dbus-send --system --print-reply 
  --dest=org.freedesktop.ConsoleKit 
  /org/freedesktop/ConsoleKit/Manager 
  org.freedesktop.ConsoleKit.Manager.Stop
</code></pre></div>


<p>What I found most interesting however was to query the busses. You can
do this with <strong>dbus-send</strong> although it is much easier to use tools such
as <strong>d-feet</strong> or <strong>qdbus</strong>.</p>
<p>To list current services on the system bus:</p>
<div class="highlight"><pre><span></span><code>~# qdbus --system
:1.1
 org.freedesktop.ConsoleKit
:1.10
:1.2
:1.3
 org.freedesktop.PolicyKit1
:1.36
 fi.epitest.hostap.WPASupplicant
 fi.w1.wpa_supplicant1
:1.4
:1.42
:1.5
:1.6
:1.7
 org.freedesktop.UPower
:1.8
:1.9
org.freedesktop.DBus
</code></pre></div>


<p>The numbers are generated by D-Bus itself, the namespace-like strings
are taken by the objects. To see what is provided by a particular
service:</p>
<div class="highlight"><pre><span></span><code>~# qdbus --system org.freedesktop.PolicyKit1
/
/org
/org/freedesktop
/org/freedesktop/PolicyKit1
/org/freedesktop/PolicyKit1/Authority
</code></pre></div>


<p>The methods made available through one of these:</p>
<div class="highlight"><pre><span></span><code>~# qdbus --system org.freedesktop.PolicyKit1 /org/freedesktop/PolicyKit1/Authority
method QDBusVariant org.freedesktop.DBus.Properties.Get(QString interface_name, QString property_name)
method QVariantMap org.freedesktop.DBus.Properties.GetAll(QString interface_name)
...
property read uint org.freedesktop.PolicyKit1.Authority.BackendFeatures
property read QString org.freedesktop.PolicyKit1.Authority.BackendName
property read QString org.freedesktop.PolicyKit1.Authority.BackendVersion
method void org.freedesktop.PolicyKit1.Authority.AuthenticationAgentResponse(QString cookie, QDBusRawType::(sa{sv} identity)
method void org.freedesktop.PolicyKit1.Authority.CancelCheckAuthorization(QString cancellation_id)
signal void org.freedesktop.PolicyKit1.Authority.Changed()
...
</code></pre></div>


<p>Access to methods and interfaces is governed through XML files in
<code>/etc/dbus-1/system.d</code> (or <code>session.d</code> depending on the bus). Let's look
at <code>/etc/dbus-1/system.d/dnsmasq.conf</code> as an example:</p>
<div class="highlight"><pre><span></span><code>&lt;busconfig&gt;
        &lt;policy user=&quot;root&quot;&gt;
                &lt;allow own=&quot;uk.org.thekelleys.dnsmasq&quot;/&gt;
                &lt;allow send_destination=&quot;uk.org.thekelleys.dnsmasq&quot;/&gt;
        &lt;/policy&gt;
        &lt;policy user=&quot;dnsmasq&quot;&gt;
                &lt;allow own=&quot;uk.org.thekelleys.dnsmasq&quot;/&gt;
                &lt;allow send_destination=&quot;uk.org.thekelleys.dnsmasq&quot;/&gt;
        &lt;/policy&gt;
        &lt;policy context=&quot;default&quot;&gt;
                &lt;deny own=&quot;uk.org.thekelleys.dnsmasq&quot;/&gt;
                &lt;deny send_destination=&quot;uk.org.thekelleys.dnsmasq&quot;/&gt;
        &lt;/policy&gt;
&lt;/busconfig&gt;
</code></pre></div>


<p>The configuration mentions that only the root Linux user can 'assign' a
service/application to the <code>uk.org.thekelleys.dnsmasq</code> name, and root
can send messages to this same service/application name. The default is
that no-one can own and send to this service/application name. As a
result, only the Linux root user can interact with this object.</p>
<p>D-Bus also supports starting of services when a method is invoked
(instead of running this service immediately). This is configured
through <code>*.service</code> files inside <code>/usr/share/dbus-1/system-services/</code>.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'd-bus-quick-recap';
                var disqus_url = 'http://blog.siphos.be/2014/06/d-bus-quick-recap/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>