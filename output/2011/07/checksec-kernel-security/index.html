<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>checksec kernel security - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.siphos.be/2011/07/checksec-kernel-security/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="description" content="I have blogged about checksec.sh earlier before. Jono, one of the #gentoo-hardened IRC-members, kindly pointed me to its --kernel option. So I feel obliged to give its options a stab as well. So, here goes the next batch of OPE-style (One Paragraph Explanations). ~# checksec.sh --kernel * Kernel protection information …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="checksec kernel security"/>
        <meta property="og:url" content="http://blog.siphos.be/2011/07/checksec-kernel-security/"/>
        <meta property="og:description" content="I have blogged about checksec.sh earlier before. Jono, one of the #gentoo-hardened IRC-members, kindly pointed me to its --kernel option. So I feel obliged to give its options a stab as well. So, here goes the next batch of OPE-style (One Paragraph Explanations). ~# checksec.sh --kernel * Kernel protection information …"/>
        <meta property="article:published_time" content="2011-07-24" />
            <meta property="article:section" content="Security" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="http://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="http://blog.siphos.be/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>



        <link href="http://blog.siphos.be/feeds/security.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... Security ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.siphos.be/2011/07/checksec-kernel-security/"
                       rel="bookmark"
                       title="Permalink to checksec kernel security">
                        checksec kernel security
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2011-07-24T00:18:00+02:00"> Sun 24 July 2011</time>
    </span>


            <span class="label label-default">By</span>
            <a href="http://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="http://blog.siphos.be/category/security.html">Security</a>


    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>I have
<a href="http://blog.siphos.be/2011/07/high-level-explanation-on-some-binary-executable-security/">blogged</a>
about <a href="http://www.trapkit.de/tools/checksec.html">checksec.sh</a> earlier
before. Jono, one of the #gentoo-hardened IRC-members, kindly pointed
me to its <code>--kernel</code> option. So I feel obliged to give its options a
stab as well. So, here goes the next batch of OPE-style (One Paragraph
Explanations).</p>
<div class="highlight"><pre><span></span><code>~# checksec.sh --kernel
* Kernel protection information:

  Description - List the status of kernel protection mechanisms. Rather than
  inspect kernel mechanisms that may aid in the prevention of exploitation of
  userspace processes, this option lists the status of kernel configuration
  options that harden the kernel itself against attack.

  Kernel config: /proc/config.gz

  GCC stack protector support:            Enabled
  Strict user copy checks:                Enabled
  Enforce read-only kernel data:          Disabled
  Restrict /dev/mem access:               Enabled
  Restrict /dev/kmem access:              Enabled

* grsecurity / PaX: Custom GRKERNSEC

  Non-executable kernel pages:            Enabled
  Prevent userspace pointer deref:        Disabled
  Prevent kobject refcount overflow:      Enabled
  Bounds check heap object copies:        Enabled
  Disable writing to kmem/mem/port:       Enabled
  Disable privileged I/O:                 Enabled
  Harden module auto-loading:             Enabled
  Hide kernel symbols:                    Enabled

* Kernel Heap Hardening: No KERNHEAP

  The KERNHEAP hardening patchset is available here:
    https://www.subreption.com/kernheap/
</code></pre></div>


<p>In-kernel <strong>GCC stack protector support</strong> is the same as the <strong>Canary</strong>
explanation I gave earlier, but now for the kernel code. Memory used by
the stack (which contains both function variables as well as return
addresses) is "interleaved" with specific data (canaries) which are
checked before using a return address that is on the stack. If the
canary doesn't match, you'll see a nice kernel panic. This is to prevent
buffer overflows that might influence the in-kernel activity flow or
overwrite data.</p>
<p>When talking about <strong>Strict user copy checks</strong>, one can compare this
with the <strong>FORTIFY_SOURCE</strong> explanation given earlier. Although not the
same implementation-wise (since the latter is gcc/glibc bound, whereas
the Linux kernel does not use glibc) this too enables the compiler to
detect function calls with variable length data arguments to an extend
that it can predict the (should-be) length of the argument. If this is
the case, the function is switched with a(nother in-kernel) function
that either continues the call, or break in case of a length mismatch.
This is to prevent buffer overflows that might corrupt the stack (or
other data locations).</p>
<p><strong>Enforce read-only kernel data</strong> marks specific kernel data sections as
read-only to prevent accidental (or malicious) manipulations.</p>
<p>When selecting <strong>Restrict /dev/mem access</strong>, the kernel does not allow
applications (even those running as root) to access all of memory.
Instead, they are only allowed to see device-mapped memory (and their
own process memory). The same goes for <strong>Restrict /dev/kmem access</strong>,
which is specifically for kernel memory.</p>
<p><strong>Non-executable kernel pages</strong> is similar to the <strong>NX</strong> explanation
given earlier. It makes sure that pages marked as holding data can not
contain executable code (and will as such never be "jumped" in) and
pages marked as holding code will never be written to.</p>
<p>To explain <strong>Prevent userspace pointer deref</strong>, first you need to
understand the difference between a <em>userland address</em> and a <em>kernel
address</em>. Each application holds its own, private virtual address space.
Part of that virtual address space is "reserved" for most of the kernel
data (in other words, the kernel data is available in each process'
virtual address space), the rest is for the application. When
interaction with the kernel occurs, a userland address is given to the
kernel, which needs to translate it to a proper address (and treat it as
data). With <strong>Prevent userspace pointer deref</strong>, specific checks are
made to ensure that the kernel doesn't directly use userspace pointers,
because that could be exploited by (malicious) software to trick the
kernel into doing things it shouldn't.</p>
<p>Reference counters in the Linux kernel are used to track users of
specific objects or resources. A "popular" way to mistreat reference
counters (or any counter per se) is to increment them that much until
they overflow and wrap around, setting the counter to zero (or a
negative number), leading to unexpected results (such as freeing memory
that is in use). The <strong>Prevent kobject refcount overflow</strong> detects this
for kobject resources and ensures that no wrap-around happens.</p>
<p>The <strong>Bounds check heap object copies</strong> checks if particular memory
copies use memory fragments within proper bounds. If the memory copy is
for a fragment that crosses that bound (for instance because the
fragment is too large) the copy fails. This offers some support against
overflows, similar to (but not the same as) the use of the stack
protector mentioned above.</p>
<p><strong>Disable writing to kmem/mem/port</strong> is similar to the <strong>Restrict
/dev/(k)mem access</strong> settings, plus disable <code>/dev/port</code> from being
opened.</p>
<p>By selecting <strong>Disable privileged I/O</strong>, access to the kernel through
functions like ioperm and iopl is prohibited. These functions are
sometimes used by applications that need direct device access, like
Xorg, but if you do not have such applications, it is wise to disable
privileged I/O access. If not, any vulnerability in such an application
might result in malicious code tampering with your devices.</p>
<p>When <strong>Harden module auto-loading</strong> is set, processes that do not run as
root will not be able to have particular kernel modules auto-loaded.
Although this seems strange, it isn't. Suppose you have an application
that wants to perform some IPv6 actions. Such applications can call
<code>request_module</code> to ask the Linux kernel to load in a particular
service. If the kernel supports IPv6 through a module, then it will load
IPv6 support (you might have seen traces in your logs about <code>net-pf-10</code>
- well, that's the IPv6 support). You can disable auto-loading
completely, but that might not be what you want. With this setting
enabled, auto-loading is supported but only for root-running
applications.</p>
<p>The added security of <strong>Hide kernel symbols</strong> is not to prevent
activities, but to prevent information to be leaked and (ab)used by
malicious users. Kernel symbols are string representations of functions
or variables that the kernel offers to kernel users (such as kernel
modules and drivers). This is needed because the location of these
functions/variables in memory cannot be provided in advance (this is no
different from symbols used as explained in the <strong>RELRO</strong> security
setting in my previous posting). By hiding these symbols from any user
without sufficiently high privileges (and limit the exposure for high
privileged process to well-known locations so these too can be protected
by other means) it is far more difficult for malicious users to find out
about available functions/variables on your system.</p>
<p>Finally, <strong>Kernel Heap Hardening</strong> enhances the in-kernel dynamic memory
allocator with additional hardening features (double-free protection,
use-after-free protection, ...). It tries to ensure proper use of the
allocated memory segments and protect against improper access.</p>
<p>From reading all this, you probably imagine why this isn't all enabled
by default. Well, many of the settings have implications on how the
system behaves. Some restrict functionalities to the root user only
(making it sometimes less user-friendly), some disable functionalities
that are needed (like the I/O access) or are (ab)used (like the user
space pointer deref which is used by many virtualization solutions)
while others add some additional overhead (the more you check, the
longer an action takes before it completes).</p>
<p>To help users select the proper settings, Gentoo Hardened tries to
differentiate settings based on <em>workstation</em> and <em>virtualization</em>
usage. So you get most security settings for "No Workstation, No
Virtualization" and less for each of those you enable. But of course,
like always, Gentoo supports custom settings too so you don't have to
follow the differentiation we suggest ;-)</p>
<p>Find something incorrect in the above paragraphs? Or too much
sales-speak and too little explanation? Give me a shout (and prove me
wrong) ;-)</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'checksec-kernel-security';
                var disqus_url = 'http://blog.siphos.be/2011/07/checksec-kernel-security/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>