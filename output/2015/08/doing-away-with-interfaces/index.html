<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Doing away with interfaces - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.siphos.be/2015/08/doing-away-with-interfaces/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="keywords" content="selinux,cil" />
        <meta name="description" content="CIL is SELinux&#39; Common Intermediate Language, which brings on a whole new set of possibilities with policy development. I hardly know CIL but am (slowly) learning. Of course, the best way to learn is to try and do lots of things with it, but real-life work and time-to-market for now …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Doing away with interfaces"/>
        <meta property="og:url" content="http://blog.siphos.be/2015/08/doing-away-with-interfaces/"/>
        <meta property="og:description" content="CIL is SELinux&#39; Common Intermediate Language, which brings on a whole new set of possibilities with policy development. I hardly know CIL but am (slowly) learning. Of course, the best way to learn is to try and do lots of things with it, but real-life work and time-to-market for now …"/>
        <meta property="article:published_time" content="2015-08-29" />
            <meta property="article:section" content="SELinux" />
            <meta property="article:tag" content="selinux" />
            <meta property="article:tag" content="cil" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="http://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="http://blog.siphos.be/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>



        <link href="http://blog.siphos.be/feeds/selinux.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... SELinux ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.siphos.be/2015/08/doing-away-with-interfaces/"
                       rel="bookmark"
                       title="Permalink to Doing away with interfaces">
                        Doing away with interfaces
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2015-08-29T11:30:00+02:00"> Sat 29 August 2015</time>
    </span>


            <span class="label label-default">By</span>
            <a href="http://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="http://blog.siphos.be/category/selinux.html">SELinux</a>


<span class="label label-default">Tags</span>
	<a href="http://blog.siphos.be/tag/selinux/">selinux</a>
        /
	<a href="http://blog.siphos.be/tag/cil/">cil</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>CIL is SELinux' Common Intermediate Language, which brings on a whole new set of
possibilities with policy development. I hardly know CIL but am (slowly)
learning. Of course, the best way to learn is to try and do lots of things with
it, but real-life work and time-to-market for now forces me to stick with the
M4-based refpolicy one.</p>
<p>Still, I do try out some things here and there, and one of the things I wanted
to look into was how CIL policies would deal with interfaces.</p>


<p><strong>Recap on interfaces</strong></p>
<p>With the M4 based reference policy, interfaces are M4 macros that expand into
the standard SELinux rules. They are used by the reference policy to provide 
a way to isolate module-specific code and to have "public" calls.</p>
<p>Policy modules are not allowed (by convention) to call types or domains that
are not defined by the same module. If they want to interact with those modules,
then they need to call the interface(s):</p>
<div class="highlight"><pre><span></span><code># module &quot;ntp&quot;
# domtrans: when executing an ntpd_exec_t binary, the resulting process 
#           runs in ntpd_t
interface(`ntp_domtrans&#39;,`
  domtrans_pattern($1, ntpd_exec_t, ntpd_t)
)

# module &quot;hal&quot;
ntp_domtrans(hald_t)
</code></pre></div>


<p>In the above example, the purpose is to have <code>hald_t</code> be able to execute
binaries labeled as <code>ntpd_exec_t</code> and have the resulting process run as the
<code>ntpd_t</code> domain.</p>
<p>The following would not be allowed inside the hal module:</p>
<div class="highlight"><pre><span></span><code>domtrans_pattern(hald_t, ntpd_exec_t, ntpd_t)
</code></pre></div>


<p>This would imply that both <code>hald_t</code>, <code>ntpd_exec_t</code> and <code>ntpd_t</code> are defined
by the same module, which is not the case.</p>
<p><strong>Interfaces in CIL</strong></p>
<p>It <em>seems</em> that CIL will not use interface files. Perhaps some convention
surrounding it will be created - to know this, we'll have to wait until a
"cilrefpolicy" is created. However, functionally, this is no longer necessary.</p>
<p>Consider the <code>myhttp_client_packet_t</code> declaration from a <a href="http://blog.siphos.be/2015/08/filtering-network-access-per-application/">previous post</a>.
In it, we wanted to allow <code>mozilla_t</code> to send and receive these packets. The 
example didn't use an interface-like construction for this, so let's see
how this would be dealt with.</p>
<p>First, the module is slightly adjusted to create a <em>macro</em> called <code>myhttp_sendrecv_client_packet</code>:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nv">macro</span> <span class="nv">myhttp_sendrecv_client_packet</span> <span class="p">((</span><span class="k">type</span> <span class="nv">domain</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">typeattributeset</span> <span class="nv">cil_gen_require</span> <span class="nv">domain</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">allow</span> <span class="nv">domain</span> <span class="nv">myhttp_client_packet_t</span> <span class="p">(</span><span class="nv">packet</span> <span class="p">(</span><span class="nv">send</span> <span class="nv">recv</span><span class="p">)))</span>
<span class="p">)</span>
</code></pre></div>


<p>Another module would then call this:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nv">call</span> <span class="nv">myhttp_sendrecv_client_packet</span> <span class="p">(</span><span class="nv">mozilla_t</span><span class="p">))</span>
</code></pre></div>


<p>That's it. When the policy modules are both loaded, then the <code>mozilla_t</code> domain is able
to send and receive <code>myhttp_client_packet_t</code> labeled packets.</p>
<p><strong>There's more: namespaces</strong></p>
<p>But it doesn't end there. Whereas the reference policy had a single namespace
for the interfaces, CIL is able to use namespaces. It allows to create an almost
object-like approach for policy development.</p>
<p>The above <code>myhttp_client_packet_t</code> definition could be written as follows:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">block</span> <span class="nv">myhttp</span>
  <span class="c1">; MyHTTP client packet</span>
  <span class="p">(</span><span class="k">type</span> <span class="nv">client_packet_t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">roletype</span> <span class="nv">object_r</span> <span class="nv">client_packet_t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">typeattributeset</span> <span class="nv">client_packet_type</span> <span class="p">(</span><span class="nv">client_packet_t</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">typeattributeset</span> <span class="nv">packet_type</span> <span class="p">(</span><span class="nv">client_packet_t</span><span class="p">))</span>

  <span class="p">(</span><span class="nv">macro</span> <span class="nv">sendrecv_client_packet</span> <span class="p">((</span><span class="k">type</span> <span class="nv">domain</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">typeattributeset</span> <span class="nv">cil_gen_require</span> <span class="nv">domain</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">allow</span> <span class="nv">domain</span> <span class="nv">client_packet_t</span> <span class="p">(</span><span class="nv">packet</span> <span class="p">(</span><span class="nv">send</span> <span class="nv">recv</span><span class="p">)))</span>
  <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>


<p>The other module looks as follows:</p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="k">block</span> <span class="nv">mozilla</span>
  <span class="p">(</span><span class="nv">typeattributeset</span> <span class="nv">cil_gen_require</span> <span class="nv">mozilla_t</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">call</span> <span class="nv">myhttp.sendrecv_client_packet</span> <span class="p">(</span><span class="nv">mozilla_t</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div>


<p>The result is similar, but not fully the same. The packet is no longer called
<code>myhttp_client_packet_t</code> but <code>myhttp.client_packet_t</code>. In other words, a period (<code>.</code>)
is used to separate the object name (<code>myhttp</code>) and the object/type (<code>client_packet_t</code>)
as well as interface/macro (<code>sendrecv_client_packet</code>):</p>
<div class="highlight"><pre><span></span><code><span class="go">~$ sesearch -s mozilla_t -c packet -p send -Ad</span>
<span class="go">  ...</span>
<span class="go">  allow mozilla_t myhttp.client_packet_t : packet { send recv };</span>
</code></pre></div>


<p>And it looks that namespace support goes even further than that, but I still
need to learn more about it first.</p>
<p>Still, I find this a good evolution. With CIL interfaces are no longer separate
from the module definition: everything is inside the CIL file. I secretly hope
that tools such as <code>seinfo</code> would support querying macros as well.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'doing-away-with-interfaces';
                var disqus_url = 'http://blog.siphos.be/2015/08/doing-away-with-interfaces/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>