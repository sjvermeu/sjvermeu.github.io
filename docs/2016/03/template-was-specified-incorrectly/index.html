<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Template was specified incorrectly - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://blog.siphos.be/2016/03/template-was-specified-incorrectly/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="keywords" content="salt" />
        <meta name="description" content="After reorganizing my salt configuration, I received the following error: [ERROR ] Template was specified incorrectly: False Enabling some debugging on the command gave me a slight pointer why this occurred: [DEBUG ] Could not find file from saltenv &#39;testing&#39;, u&#39;salt://top.sls&#39; [DEBUG ] No contents loaded for env: testing [DEBUG …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Template was specified incorrectly"/>
        <meta property="og:url" content="https://blog.siphos.be/2016/03/template-was-specified-incorrectly/"/>
        <meta property="og:description" content="After reorganizing my salt configuration, I received the following error: [ERROR ] Template was specified incorrectly: False Enabling some debugging on the command gave me a slight pointer why this occurred: [DEBUG ] Could not find file from saltenv &#39;testing&#39;, u&#39;salt://top.sls&#39; [DEBUG ] No contents loaded for env: testing [DEBUG …"/>
        <meta property="article:published_time" content="2016-03-27" />
            <meta property="article:section" content="Free Software" />
            <meta property="article:tag" content="salt" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="https://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="https://blog.siphos.be/feed/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>

        <link href="https://blog.siphos.be/feed/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Simplicity is a form of art... RSS Feed"/>


        <link href="https://blog.siphos.be/category/free-software/feed/atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... Free Software ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="https://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://blog.siphos.be/2016/03/template-was-specified-incorrectly/"
                       rel="bookmark"
                       title="Permalink to Template was specified incorrectly">
                        Template was specified incorrectly
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-03-27T13:32:00+02:00"> Sun 27 March 2016</time>
    </span>


            <span class="label label-default">By</span>
            <a href="https://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="https://blog.siphos.be/category/free-software.html">Free Software</a>


<span class="label label-default">Tags</span>
	<a href="https://blog.siphos.be/tag/salt/">salt</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>After reorganizing my salt configuration, I received the following error:</p>
<div class="highlight"><pre><span></span><code>[ERROR   ] Template was specified incorrectly: False
</code></pre></div>


<p>Enabling some debugging on the command gave me a slight pointer why this occurred:</p>
<div class="highlight"><pre><span></span><code>[DEBUG   ] Could not find file from saltenv &#39;testing&#39;, u&#39;salt://top.sls&#39;
[DEBUG   ] No contents loaded for env: testing
[DEBUG   ] compile template: False
[ERROR   ] Template was specified incorrectly: False
</code></pre></div>


<p>I was using a single top file as recommended by Salt, but apparently it was still
looking for top files in the other environments.</p>
<p>Yet, if I split the top files across the environments, I got the following warning:</p>
<div class="highlight"><pre><span></span><code>[WARNING ] Top file merge strategy set to &#39;merge&#39; and multiple top files found. Top file merging order is undefined; for better results use &#39;same&#39; option
</code></pre></div>


<p>So what's all this about?</p>


<p><strong>When using a single top file is preferred</strong></p>
<p>If you want to stick with a single top file, then the first error is (or at least, in my case)
caused by my environments not having a fall-back definition.</p>
<p>My <code>/etc/salt/master</code> configuration file had the following <code>file_roots</code> setting:</p>
<div class="highlight"><pre><span></span><code>file_roots:
  base:
    - /srv/salt/base
  testing:
    - /srv/salt/testing
</code></pre></div>


<p>The problem is that Salt expects ''a'' top file through the environment. What I had to do was to
set the fallback directory to the base directory again, like so:</p>
<div class="highlight"><pre><span></span><code>file_roots:
  base:
    - /srv/salt/base
  testing:
    - /srv/salt/testing
    - /srv/salt/base
</code></pre></div>


<p>With this set, the error disappeared and both salt and myself were happy again.</p>
<p><strong>When multiple top files are preferred</strong></p>
<p>If you really want to use multiple top files (which is also a use case in my configuration),
then first we need to make sure that the top files of all environments correctly isolate the
minion matches. If two environments would match the same minion, then this approach becomes
more troublesome.</p>
<p>On the one hand, we can just let saltstack merge the top files (default behavior) but the order
of the merging is undefined (and no, you can't set it using <code>env_order</code>) which might result in 
salt states being executed in an unexpected order. If the definitions are done to such an extend
that this is not a problem, then you can just ignore the warning. See also
<a href="https://github.com/saltstack/salt/issues/29104">bug 29104</a> about the warning itself.</p>
<p>But better would be to have the top files of the environment(s) isolated so that each environment
top file completely manages the entire environment. When that is the case, then we tell salt that
only the top file of the affected environment should be used. This is done using the following
setting in <code>/etc/salt/master</code>:</p>
<div class="highlight"><pre><span></span><code>top_file_merging_strategy: same
</code></pre></div>


<p>If this is used, then the <code>env_order</code> setting is used to define in which order the environments
are processed. </p>
<p>Oh and if you're using <code>salt-ssh</code>, then be sure to set the environment of the minion in the roster
file, as there is no running minion on the target system that informs salt about the environment 
to use otherwise:</p>
<div class="highlight"><pre><span></span><code># In /etc/salt/roster
testserver:
  host: testserver.example.com
  minion_opts:
    environment: testing
</code></pre></div>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'template-was-specified-incorrectly';
                var disqus_url = 'https://blog.siphos.be/2016/03/template-was-specified-incorrectly/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://www.gentoo.org" target="_blank">
                Gentoo Linux
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>