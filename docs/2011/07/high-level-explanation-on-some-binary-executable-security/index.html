<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>High level explanation on some binary executable security - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://blog.siphos.be/2011/07/high-level-explanation-on-some-binary-executable-security/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="description" content="One very important functionality offered by Gentoo Hardened is a specific toolchain (compiler, libraries and more) that contains patches to make the built binaries a bit more protected from certain vulnerabilities. Explaining all those in detail is too much for a simple blog post like this, but some time ago …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="High level explanation on some binary executable security"/>
        <meta property="og:url" content="https://blog.siphos.be/2011/07/high-level-explanation-on-some-binary-executable-security/"/>
        <meta property="og:description" content="One very important functionality offered by Gentoo Hardened is a specific toolchain (compiler, libraries and more) that contains patches to make the built binaries a bit more protected from certain vulnerabilities. Explaining all those in detail is too much for a simple blog post like this, but some time ago …"/>
        <meta property="article:published_time" content="2011-07-15" />
            <meta property="article:section" content="Security" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="https://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="https://blog.siphos.be/feed/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>

        <link href="https://blog.siphos.be/feed/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Simplicity is a form of art... RSS Feed"/>


        <link href="https://blog.siphos.be/category/security/feed/atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... Security ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="https://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://blog.siphos.be/2011/07/high-level-explanation-on-some-binary-executable-security/"
                       rel="bookmark"
                       title="Permalink to High level explanation on some binary executable security">
                        High level explanation on some binary executable security
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2011-07-15T22:01:00+02:00"> Fri 15 July 2011</time>
    </span>


            <span class="label label-default">By</span>
            <a href="https://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="https://blog.siphos.be/category/security.html">Security</a>


    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>One very important functionality offered by <a href="http://hardened.gentoo.org">Gentoo
Hardened</a> is a specific toolchain (compiler,
libraries and more) that contains patches to make the built binaries a
bit more protected from certain vulnerabilities. Explaining all those in
detail is too much for a simple blog post like this, but some time ago
the friendly folks of the Gentoo Hardened project told be about a script
called <a href="http://www.trapkit.de/tools/checksec.html">checksec.sh</a> that
displays a few of those protections on a binary.</p>
<p>So what can I find out of such a run? Let me show you the output on two
binaries here:</p>
<div class="highlight"><pre><span></span><code>~$ checksec.sh --file /opt/skype/skype
RELRO           STACK CANARY      NX            PIE                     FILE
No RELRO        Canary found      NX disabled   No PIE                  /opt/skype/skype

~$ checksec.sh --file /bin/bash
RELRO           STACK CANARY      NX            PIE                     FILE
Full RELRO      Canary found      NX enabled    PIE enabled             /bin/bash
</code></pre></div>


<p>It even comes with pretty colors (the "No RELRO" is red whereas "Full
RELRO" is green). But beyond interpreting those colors (which should be
obvious for the non-colorblind), what does that all mean? Well, let me
try to explain them in one-paragraph entries (yes, I like such
challenges ;-) Note that, if a protection is not found, then it probably
means that the application was not built with this protection (the skype
example, since this is a binary from Skype\^WMicrosoft, versus bash
which is built by the Gentoo Hardened toolchain).</p>
<p><strong>RELRO</strong> stands for <em>Relocation Read-Only</em>, meaning that the headers in
your binary, which need to be writable during startup of the application
(to allow the dynamic linker to load and link stuff like shared
libraries) are marked as read-only when the linker is done doing its
magic (but before the application itself is launched). The difference
between <strong>Partial RELRO</strong> and <strong>Full RELRO</strong> is that the Global Offset
Table (and Procedure Linkage Table) which act as kind-of
process-specific lookup tables for symbols (names that need to point to
locations elsewhere in the application or even in loaded shared
libraries) are marked read-only too in the <strong>Full RELRO</strong>. Downside of
this is that lazy binding (only resolving those symbols the first time
you hit them, making applications start a bit faster) is not possible
anymore.</p>
<p>A <strong>Canary</strong> is a certain value put on the stack (memory where function
local variables are also stored) and validated before that function is
left again. Leaving a function means that the "previous" address (i.e.
the location in the application right before the function was called) is
retrieved from this stack and jumped to (well, the part right after that
address - we do not want an endless loop do we?). If the <strong>canary</strong>
value is not correct, then the stack might have been overwritten /
corrupted (for instance by writing more stuff in the local variable than
allowed - called <em>buffer overflow</em>) so the application is immediately
stopped.</p>
<p>The abbreviation <strong>NX</strong> stands for non-execute or non-executable
segment. It means that the application, when loaded in memory, does not
allow any of its segments to be both writable and executable. The idea
here is that writable memory should never be executed (as it can be
manipulated) and vice versa. Having <strong>NX enabled</strong> would be good.</p>
<p>The last abbreviation is <strong>PIE</strong>, meaning <em>Position Independent
Executable</em>. A <strong>No PIE</strong> application tells the loader which virtual
address it should use (and keeps its memory layout quite static). Hence,
attacks against this application know up-front how the virtual memory
for this application is (partially) organized. Combined with in-kernel
ASLR (<em>Address Space Layout Randomization</em>, which Gentoo's
hardened-sources of course support) PIE applications have a more diverge
memory organization, making attacks that rely on the memory structure
more difficult.</p>
<p>But hold on, the checksec.sh application also supports detection for
<code>FORTIFY_SOURCE</code>:</p>
<div class="highlight"><pre><span></span><code>~$ checksec.sh --fortify-file /opt/skype/skype
 * FORTIFY_SOURCE support available (libc)    : Yes
* Binary compiled with FORTIFY_SOURCE support: Yes

 ------ EXECUTABLE-FILE ------- . -------- LIBC --------
 FORTIFY-able library functions | Checked function names
 -------------------------------------------------------
 printf                         | __printf_chk
...
SUMMARY:

* Number of checked functions in libc                : 75
* Total number of library functions in the executable: 2468
* Number of FORTIFY-able functions in the executable : 25
* Number of checked functions in the executable      : 0
* Number of unchecked functions in the executable    : 25
</code></pre></div>


<p>In the given example, my system does support <code>FORTIFY_SOURCE</code> and the
binary is supposedly built with this support as well, but the checks
return that out of the 25 functions identified as <code>FORTIFY</code>-able, none
of them were successfully verified as using a <code>FORTIFY</code>-ed library call.
It goes without saying that for the /bin/bash binary, this yielded a bit
more good results (12 out of 30 verified).</p>
<p>Again, what is <strong>FORTIFY_SOURCE</strong>? Well, when using <code>FORTIFY_SOURCE</code>,
the compiler will try to intelligently read the code it is compiling /
building. When it sees a C-library function call against a variable
whose size it can deduce (like a fixed-size array - it is more
intelligent than this btw) it will replace the call with a <code>FORTIFY</code>'ed
function call, passing on the maximum size for the variable. If this
special function call notices that the variable is being overwritten
beyond its boundaries, it forces the application to quit immediately.
Note that not all function calls that can be fortified are fortified as
that depends on the intelligence of the compiler (and if it is realistic
to get the maximum size).</p>
<p>If you do not agree with the explanation above, please comment... and
try to explain it in a single paragraph without going too detailed (i.e.
do not assume people are capable of writing their own compiler just for
fun).</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'high-level-explanation-on-some-binary-executable-security';
                var disqus_url = 'https://blog.siphos.be/2011/07/high-level-explanation-on-some-binary-executable-security/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://www.gentoo.org" target="_blank">
                Gentoo Linux
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>