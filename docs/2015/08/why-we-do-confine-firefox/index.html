<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Why we do confine Firefox - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.siphos.be/2015/08/why-we-do-confine-firefox/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="keywords" content="gentoo,selinux,policy,firefox,cve,vulnerability,xdg" />
        <meta name="description" content="If you&#39;re a bit following the SELinux development community you will know Dan Walsh, a Red Hat security engineer. Today he blogged about CVE-2015-4495 and SELinux, or why doesn&#39;t SELinux confine Firefox. He should&#39;ve asked why the reference policy or Red Hat/Fedora policy does not confine Firefox, because SELinux …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Why we do confine Firefox"/>
        <meta property="og:url" content="http://blog.siphos.be/2015/08/why-we-do-confine-firefox/"/>
        <meta property="og:description" content="If you&#39;re a bit following the SELinux development community you will know Dan Walsh, a Red Hat security engineer. Today he blogged about CVE-2015-4495 and SELinux, or why doesn&#39;t SELinux confine Firefox. He should&#39;ve asked why the reference policy or Red Hat/Fedora policy does not confine Firefox, because SELinux …"/>
        <meta property="article:published_time" content="2015-08-11" />
            <meta property="article:section" content="SELinux" />
            <meta property="article:tag" content="gentoo" />
            <meta property="article:tag" content="selinux" />
            <meta property="article:tag" content="policy" />
            <meta property="article:tag" content="firefox" />
            <meta property="article:tag" content="cve" />
            <meta property="article:tag" content="vulnerability" />
            <meta property="article:tag" content="xdg" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="http://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="http://blog.siphos.be/feed/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>

        <link href="http://blog.siphos.be/feed/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Simplicity is a form of art... RSS Feed"/>


        <link href="http://blog.siphos.be/category/selinux/feed/atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... SELinux ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.siphos.be/2015/08/why-we-do-confine-firefox/"
                       rel="bookmark"
                       title="Permalink to Why we do confine Firefox">
                        Why we do confine Firefox
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2015-08-11T19:18:00+02:00"> Tue 11 August 2015</time>
    </span>


            <span class="label label-default">By</span>
            <a href="http://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="http://blog.siphos.be/category/selinux.html">SELinux</a>


<span class="label label-default">Tags</span>
	<a href="http://blog.siphos.be/tag/gentoo/">gentoo</a>
        /
	<a href="http://blog.siphos.be/tag/selinux/">selinux</a>
        /
	<a href="http://blog.siphos.be/tag/policy/">policy</a>
        /
	<a href="http://blog.siphos.be/tag/firefox/">firefox</a>
        /
	<a href="http://blog.siphos.be/tag/cve/">cve</a>
        /
	<a href="http://blog.siphos.be/tag/vulnerability/">vulnerability</a>
        /
	<a href="http://blog.siphos.be/tag/xdg/">xdg</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>If you're a bit following the SELinux development community you will know
<a href="http://danwalsh.livejournal.com">Dan Walsh</a>, a <a href="http://people.redhat.com/dwalsh/">Red Hat</a>
security engineer. Today he <a href="http://danwalsh.livejournal.com/72697.html">blogged</a> 
about <em>CVE-2015-4495 and SELinux, or why doesn't SELinux confine Firefox</em>. He 
should've asked why the <em>reference policy</em> or <em>Red Hat/Fedora policy</em> does not
confine Firefox, because SELinux is, as I've
<a href="http://blog.siphos.be/2015/08/dont-confuse-selinux-with-its-policy/">mentioned before</a>,
not the same as its policy.</p>
<p>In effect, Gentoo's SELinux policy <em>does</em> confine Firefox by default. One of the
principles we focus on in Gentoo Hardened is to
<a href="https://wiki.gentoo.org/wiki/Project:SELinux/Development_policy#Develop_desktop_policies">develop desktop policies</a>
in order to reduce exposure and information leakage of user documents. We might
not have the manpower to confine all desktop applications, but I do think it is
worthwhile to at least attempt to do this, even though what Dan Walsh mentioned
is also correct: desktops are notoriously difficult to use a mandatory access
control system on.</p>


<p><strong>How Gentoo wants to support more confined desktop applications</strong></p>
<p>What Gentoo Hardened tries to do is to support the
<a href="http://standards.freedesktop.org/basedir-spec/basedir-spec-0.8.html">XDG Base Directory Specification</a>
for several documentation types. Downloads are marked as <code>xdg_downloads_home_t</code>,
pictures are marked as <code>xdg_pictures_home_t</code>, etc.</p>
<p>With those types defined, we grant the regular user domains full access to
those types, but start removing access to user content from applications. Rules
such as the following are commented out or removed from the policies:</p>
<div class="highlight"><pre><span></span><code># userdom_manage_user_home_content_dirs(mozilla_t)
# userdom_manage_user_home_content_files(mozilla_t)
</code></pre></div>


<p>Instead, we add in a call to a template we have defined ourselves:</p>
<div class="highlight"><pre><span></span><code>userdom_user_content_access_template(mozilla, { mozilla_t mozilla_plugin_t })
</code></pre></div>


<p>This call makes access to user content optional through SELinux booleans. For
instance, for the <code>mozilla_t</code> domain (which is used for Firefox), the following
booleans are created:</p>
<div class="highlight"><pre><span></span><code># Read generic (user_home_t) user content
mozilla_read_generic_user_content       -&gt;      true

# Read all user content
mozilla_read_all_user_content           -&gt;      false

# Manage generic (user_home_t) user content
mozilla_manage_generic_user_content     -&gt;      false

# Manage all user content
mozilla_manage_all_user_content         -&gt;      false
</code></pre></div>


<p>As you can see, the default setting is that Firefox can read user content, but
only non-specific types. So <code>ssh_home_t</code>, which is used for the SSH related
files, is not readable by Firefox with our policy <em>by default</em>.</p>
<p>By changing these booleans, the policy is fine-tuned to the requirements of
the administrator. On my systems, <code>mozilla_read_generic_user_content</code> is switched
off.</p>
<p>You might ask how we can then still support a browser if it cannot access user
content to upload or download. Well, as mentioned before, we support the XDG
types. The browser is allowed to manage <code>xdg_download_home_t</code> files and
directories. For the majority of cases, this is sufficient. I also don't mind
copying over files to the <code>~/Downloads</code> directory just for uploading files. But
I am well aware that this is not what the majority of users would want, which
is why the default is as it is.</p>
<p><strong>There is much more work to be done sadly</strong></p>
<p>As said earlier, the default policy will allow <em>reading</em> of user files if those
files are not typed specifically. Types that are protected by our policy (but not
by the reference policy standard) includes SSH related files at <code>~/.ssh</code> and
GnuPG files at <code>~/.gnupg</code>. Even other configuration files, such as for my Mutt
configuration (<code>~/.muttrc</code>) which contains a password for an IMAP server I connect
to, are not reachable.</p>
<p>However, it is still far from perfect. One of the reasons is that many desktop
applications are not "converted" yet to our desktop policy approach. Yes, Chromium
is also already converted, and policies we've added such as for Skype also do not
allow direct access unless the user explicitly enabled it. But Evolution for instance
isn't yet.</p>
<p>Converting desktop policies to a more strict setup requires lots of testing, which
translates to many human resources. Within Gentoo, only a few developers and 
contributors are working on policies, and considering that this is not a change
that is already part of the (upstream) reference policy, some contributors also
do not want to put lots of focus on it either. But without having done the works,
it will not be easy (nor probably acceptable) to upstream this (the XDG patch has
been submitted a few times already but wasn't deemed ready yet then).</p>
<p><strong>Having a more restrictive policy isn't the end</strong></p>
<p>As the blog post of Dan rightly mentioned, there are still quite some other
ways of accessing information that we might want to protect. An application 
might not have access to user files, but can be able to communicate (for instance
through DBus) with an application that does, and through that instruct it to
pass on the data.</p>
<p>Plugins might require permissions which do not match with the principles set up
earlier. When we tried out Google Talk (needed for proper Google Hangouts support)
we noticed that it requires many, many more privileges. Luckily, we were able to
write down and develop a policy for the Google Talk plugin (<code>googletalk_plugin_t</code>)
so it is still properly confined. But this is just a single plugin, and I'm sure
that more plugins exist which will have similar requirements. Which leads to more
policy development.</p>
<p>But having workarounds does not make the effort we do worthless. Being able to
work around a firewall through application data does not make the firewall
useless, it is just one of the many security layers. The same is true with SELinux
policies.</p>
<p>I am glad that we at least try to confine desktop applications more, and
that Gentoo Hardened users who use SELinux are at least somewhat more protected
from the vulnerability (even with the default case) and that our investment for
this is sound.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'why-we-do-confine-firefox';
                var disqus_url = 'http://blog.siphos.be/2015/08/why-we-do-confine-firefox/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://www.gentoo.org" target="_blank">
                Gentoo Linux
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>