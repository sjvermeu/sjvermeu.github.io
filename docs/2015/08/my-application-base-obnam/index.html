<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>My application base: Obnam - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.siphos.be/2015/08/my-application-base-obnam/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="keywords" content="mab,backup,obnam" />
        <meta name="description" content="It is often said, yet too often forgotten: taking backups (and verifying that they work). Taking backups is not purely for companies and organizations. Individuals should also take backups to ensure that, in case of errors or calamities, the all important files are readily recoverable. For backing up files and …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="My application base: Obnam"/>
        <meta property="og:url" content="http://blog.siphos.be/2015/08/my-application-base-obnam/"/>
        <meta property="og:description" content="It is often said, yet too often forgotten: taking backups (and verifying that they work). Taking backups is not purely for companies and organizations. Individuals should also take backups to ensure that, in case of errors or calamities, the all important files are readily recoverable. For backing up files and …"/>
        <meta property="article:published_time" content="2015-08-05" />
            <meta property="article:section" content="Free Software" />
            <meta property="article:tag" content="mab" />
            <meta property="article:tag" content="backup" />
            <meta property="article:tag" content="obnam" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="http://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="http://blog.siphos.be/feed/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>

        <link href="http://blog.siphos.be/feed/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Simplicity is a form of art... RSS Feed"/>


        <link href="http://blog.siphos.be/category/free-software/feed/atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... Free Software ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.siphos.be/2015/08/my-application-base-obnam/"
                       rel="bookmark"
                       title="Permalink to My application base: Obnam">
                        My application base: Obnam
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2015-08-05T22:35:00+02:00"> Wed 05 August 2015</time>
    </span>


            <span class="label label-default">By</span>
            <a href="http://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="http://blog.siphos.be/category/free-software.html">Free Software</a>


<span class="label label-default">Tags</span>
	<a href="http://blog.siphos.be/tag/mab/">mab</a>
        /
	<a href="http://blog.siphos.be/tag/backup/">backup</a>
        /
	<a href="http://blog.siphos.be/tag/obnam/">obnam</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>It is often said, yet too often forgotten: taking backups (and verifying that 
they work). Taking backups is not purely for companies and organizations.
Individuals should also take backups to ensure that, in case of errors or
calamities, the all important files are readily recoverable.</p>
<p>For backing up files and directories, I personally use <a href="http://obnam.org/">obnam</a>,
after playing around with <a href="http://www.bacula.org/">Bacula</a> and
<a href="https://attic-backup.org/">attic</a>. Bacula is more meant for large
distributed environments (although I also tend to use obnam for my server
infrastructure) and was too complex for my taste. The choice between obnam and
attic is even more personally-oriented.</p>


<p>I found attic to be faster, but with a small supporting community. Obnam was
slower, but seems to have a more active community which I find important for 
infrastructure that is meant to live quite long (you don't want to switch 
backup solutions every year). I also found it pretty easy to work with, and
to restore files back, and Gentoo provides the <a href="https://packages.gentoo.org/package/app-backup/obnam">app-backup/obnam</a>
package.</p>
<p>I think both are decent solutions, so I had to make one choice and ended up
with obnam. So, how does it work?</p>
<p><strong>Configuring what to backup</strong></p>
<p>The basic configuration file for obnam is <code>/etc/obnam.conf</code>. Inside this file,
I tell which directories need to be backed up, as well as which subdirectories
or files (through expressions) can be left alone. For instance, I don't want
obnam to backup ISO files as those have been downloaded anyway.</p>
<div class="highlight"><pre><span></span><code><span class="k">[config]</span>
<span class="na">repository</span> <span class="o">=</span> <span class="s">/srv/backup</span>
<span class="na">root</span> <span class="o">=</span> <span class="s">/root, /etc, /var/lib/portage, /srv/virt/gentoo, /home</span>
<span class="na">exclude</span> <span class="o">=</span> <span class="s">\.img$, \.iso$, /home/[^/]*/Development/Centralized/.*</span>
<span class="na">exclude-caches</span> <span class="o">=</span> <span class="s">yes</span>

<span class="na">keep</span> <span class="o">=</span> <span class="s">8h,14d,10w,12m,10y</span>
</code></pre></div>


<p>The <code>root</code> parameter tells obnam which directories (and subdirectories) to
back up. With <code>exclude</code> a particular set of files or directories can be
excluded, for instance because these contain downloaded resources (and as such
do not need to be inside the backup archives).</p>
<p>Obnam also supports the <a href="http://www.brynosaurus.com/cachedir/spec.html">CACHEDIR.TAG</a>
specification, which I use for the various cache directories. With the use of 
these cache tag files I do not need to update the <code>obnam.conf</code> file with every
new cache directory (or software build directory).</p>
<p>The last parameter in the configuration that I want to focus on is the <code>keep</code>
parameter. Every time obnam takes a backup, it creates what it calls a new
<em>generation</em>. When the backup storage becomes too big, administrators can run
<code>obnam forget</code> to drop generations. The <code>keep</code> parameter informs obnam which
generations can be removed and which ones can be kept.</p>
<p>In my case, I want to keep one backup per hour for the last 8 hours (I normally
take one backup per day, but during some development sprees or photo
manipulations I back up multiple times), one per day for the last two weeks, 
one per week for the last 10 weeks, one per month for the last 12 months and
one per year for the last 10 years.</p>
<p>Obnam will clean up only when <code>obnam forget</code> is executed. As storage is cheap,
and the performance of obnam is sufficient for me, I do not need to call this
very often.</p>
<p><strong>Backing up and restoring files</strong></p>
<p>My backup strategy is to backup to an external disk, and then synchronize this
disk with a personal backup server somewhere else. This backup server runs no
other software beyond OpenSSH (to allow secure transfer of the backups) and both
the backup server disks and the external disk is <a href="https://wiki.gentoo.org/wiki/Dm-crypt">LUKS</a>
encrypted. Considering that I don't have government secrets I opted not to encrypt
the backup files themselves, but Obnam does support that (through GnuPG).</p>
<p>All backup enabled systems use cron jobs which execute <code>obnam backup</code> to take
the backup, and use rsync to synchronize the finished backup with the backup
server. If I need to restore a file, I use <code>obnam ls</code> to see which file(s) I
need to restore (add in a <code>--generation=</code> to list the files of a different
backup generation than the last one).</p>
<p>Then, the command to restore is:</p>
<div class="highlight"><pre><span></span><code>~# obnam restore --to=/var/restore /home/swift/Images/Processing/*.NCF
</code></pre></div>


<p>Or I can restore immediately to the directory again:</p>
<div class="highlight"><pre><span></span><code>~# obnam restore --to=/home/swift/Images/Processing /home/swift/Images/Processing/*.NCF
</code></pre></div>


<p>To support multiple clients, obnam by default identifies each client through
the hostname. It is possible to use different names, but hostnames tend to be
a common best practice which I don't deviate from either. Obnam is able to share
blocks between clients (it is not mandatory, but supported nonetheless).</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'my-application-base-obnam';
                var disqus_url = 'http://blog.siphos.be/2015/08/my-application-base-obnam/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://www.gentoo.org" target="_blank">
                Gentoo Linux
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>