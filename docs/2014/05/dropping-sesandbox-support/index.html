<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Dropping sesandbox support - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://blog.siphos.be/2014/05/dropping-sesandbox-support/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="keywords" content="Gentoo,hardened,policycoreutils,selinux,seunshare,vulnerability" />
        <meta name="description" content="A vulnerability in seunshare, part of policycoreutils, came to light recently (through bug 509896). The issue is within libcap-ng actually, but the specific situation in which the vulnerability can be exploited is only available in seunshare. Now, seunshare is not built by default on Gentoo. You need to define USE …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Dropping sesandbox support"/>
        <meta property="og:url" content="https://blog.siphos.be/2014/05/dropping-sesandbox-support/"/>
        <meta property="og:description" content="A vulnerability in seunshare, part of policycoreutils, came to light recently (through bug 509896). The issue is within libcap-ng actually, but the specific situation in which the vulnerability can be exploited is only available in seunshare. Now, seunshare is not built by default on Gentoo. You need to define USE …"/>
        <meta property="article:published_time" content="2014-05-09" />
            <meta property="article:section" content="Gentoo" />
            <meta property="article:tag" content="Gentoo" />
            <meta property="article:tag" content="hardened" />
            <meta property="article:tag" content="policycoreutils" />
            <meta property="article:tag" content="selinux" />
            <meta property="article:tag" content="seunshare" />
            <meta property="article:tag" content="vulnerability" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="https://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="https://blog.siphos.be/feed/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>

        <link href="https://blog.siphos.be/feed/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Simplicity is a form of art... RSS Feed"/>


        <link href="https://blog.siphos.be/category/gentoo/feed/atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... Gentoo ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="https://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://blog.siphos.be/2014/05/dropping-sesandbox-support/"
                       rel="bookmark"
                       title="Permalink to Dropping sesandbox support">
                        Dropping sesandbox support
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2014-05-09T21:03:00+02:00"> Fri 09 May 2014</time>
    </span>


            <span class="label label-default">By</span>
            <a href="https://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="https://blog.siphos.be/category/gentoo.html">Gentoo</a>


<span class="label label-default">Tags</span>
	<a href="https://blog.siphos.be/tag/gentoo/">Gentoo</a>
        /
	<a href="https://blog.siphos.be/tag/hardened/">hardened</a>
        /
	<a href="https://blog.siphos.be/tag/policycoreutils/">policycoreutils</a>
        /
	<a href="https://blog.siphos.be/tag/selinux/">selinux</a>
        /
	<a href="https://blog.siphos.be/tag/seunshare/">seunshare</a>
        /
	<a href="https://blog.siphos.be/tag/vulnerability/">vulnerability</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>A <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3215">vulnerability in
seunshare</a>,
part of <code>policycoreutils</code>, came to light recently (through <a href="https://bugs.gentoo.org/show_bug.cgi?id=509896">bug
509896</a>). The issue is
within <code>libcap-ng</code> actually, but the specific situation in which the
vulnerability can be exploited is only available in <code>seunshare</code>.</p>
<p>Now, <code>seunshare</code> is not built by default on Gentoo. You need to define
<code>USE="sesandbox"</code>, which I implemented as an optional build because I
see no need for the <code>seunshare</code> command and the <em>SELinux sandbox
(sesandbox)</em> support. Upstream (Fedora/RedHat) calls it <em>sandbox</em>, which
Gentoo translates to <em>sesandbox</em> as it collides with the Gentoo sandbox
support otherwise. But I digress.</p>
<p>The build of the SELinux sandbox support is optional, mostly because we
do not have a direct reason to support it. There are no Gentoo users
that I'm aware of that use it. It is used to start an application in a
chroot-like environment, based on Linux namespaces and a specific
SELinux policy called <code>sandbox_t</code>. The idea isn't that bad, but I rather
focus on proper application confinement and full system enforcement
support (rather than specific services). The SELinux sandbox makes a bit
more sense when the system supports unconfined domains (and users are in
the <code>unconfined_t</code> domain), but Gentoo focuses on strict policy support.</p>
<p>Anyway, this isn't the first vulnerability in <code>seunshare</code>. In 2011,
another privilege escalation vulnerability was found in the application
(see <a href="https://bugs.gentoo.org/show_bug.cgi?id=374897">bug 374897</a>).</p>
<p>But having a vulnerability in the application (or its interaction with
<code>libcap-ng</code>) doesn't mean an exploitable vulnerability. Most users will
not even have <code>seunshare</code>, and those that do have it will not be able to
call it if you are running with SELinux in <em>strict</em> or have
<code>USE="-unconfined"</code> set for the other policies. If <code>USE="unconfined"</code> is
set and you run <em>mcs</em>, <em>targeted</em> or <em>mls</em> (which isn't default either,
the default is <em>strict</em>) then if your users are still mapped to the
regular user domains (<code>user_t</code>, <code>staff_t</code> or even <code>sysadm_t</code>) then
<code>seunshare</code> doesn't work as the SELinux policy prevents its behavior
before the vulnerability is triggered.</p>
<p>Assuming you <em>do</em> have a <em>targeted</em> policy with users mapped to
<code>unconfined_t</code> and you have built <code>policycoreutils</code> with
<code>USE="sesandbox"</code> or you run in SELinux in permissive mode, then please
tell me if you can trigger the exploit. On my systems, <code>seunshare</code> fails
with the message that it can't drop its privileges and thus exits
(instead of executing the exploit code as it suggested by the reports).</p>
<p>Since I mentioned that most user don't use SELinux sandbox, and because
I can't even get it to work (regardless of the vulnerability), I decided
to drop support for it from the builds. That also allows me to more
quickly introduce the new userspace utilities as I don't need to
refactor the code to switch from <code>sandbox</code> to <code>sesandbox</code> anymore.</p>
<p>So, <code>policycoreutils-2.2.5-r4</code> and <code>policycoreutils-2.3_rc1-r1</code> are now
available which do not build <code>seunshare</code> anymore. And now I can focus on
providing the full <em>2.3</em> userspace that has been announced today.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'dropping-sesandbox-support';
                var disqus_url = 'https://blog.siphos.be/2014/05/dropping-sesandbox-support/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://www.gentoo.org" target="_blank">
                Gentoo Linux
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2020 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>