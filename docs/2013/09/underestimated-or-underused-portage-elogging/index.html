<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Underestimated or underused: Portage (e)logging - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://blog.siphos.be/2013/09/underestimated-or-underused-portage-elogging/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="keywords" content="elog,Gentoo,logging,portage" />
        <meta name="description" content="Within 30 minutes of each other, two people on the #gentoo channel asked if Portage kept logs of the messages displayed during the build and installation of a package. Of course, the answer is a sounding &#34;yes&#34; - and depending on your needs, you can even save more of the logging …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Underestimated or underused: Portage (e)logging"/>
        <meta property="og:url" content="http://blog.siphos.be/2013/09/underestimated-or-underused-portage-elogging/"/>
        <meta property="og:description" content="Within 30 minutes of each other, two people on the #gentoo channel asked if Portage kept logs of the messages displayed during the build and installation of a package. Of course, the answer is a sounding &#34;yes&#34; - and depending on your needs, you can even save more of the logging …"/>
        <meta property="article:published_time" content="2013-09-25" />
            <meta property="article:section" content="Gentoo" />
            <meta property="article:tag" content="elog" />
            <meta property="article:tag" content="Gentoo" />
            <meta property="article:tag" content="logging" />
            <meta property="article:tag" content="portage" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="http://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="http://blog.siphos.be/feed/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>

        <link href="http://blog.siphos.be/feed/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Simplicity is a form of art... RSS Feed"/>


        <link href="http://blog.siphos.be/category/gentoo/feed/atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... Gentoo ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://blog.siphos.be/2013/09/underestimated-or-underused-portage-elogging/"
                       rel="bookmark"
                       title="Permalink to Underestimated or underused: Portage (e)logging">
                        Underestimated or underused: Portage (e)logging
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-09-25T10:09:00+02:00"> Wed 25 September 2013</time>
    </span>


            <span class="label label-default">By</span>
            <a href="http://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="http://blog.siphos.be/category/gentoo.html">Gentoo</a>


<span class="label label-default">Tags</span>
	<a href="http://blog.siphos.be/tag/elog/">elog</a>
        /
	<a href="http://blog.siphos.be/tag/gentoo/">Gentoo</a>
        /
	<a href="http://blog.siphos.be/tag/logging/">logging</a>
        /
	<a href="http://blog.siphos.be/tag/portage/">portage</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Within 30 minutes of each other, two people on the <code>#gentoo</code> channel
asked if Portage kept logs of the messages displayed during the build
and installation of a package. Of course, the answer is a sounding "yes"
- and depending on your needs, you can even save more of the logging. If
you haven't read the <a href="http://www.gentoo.org/doc/en/handbook">Gentoo
handbook</a> yet, do so - it
contains a section on <a href="http://www.gentoo.org/doc/en/handbook/handbook-x86.xml?part=3&amp;chap=1#doc_chap4">Logging
Features</a>
that explains how and when logging is enabled.</p>
<p>Let's start with the default <em>elog</em> support. By default, Gentoo's
Portage will log messages that ebuild developers have put in the
packages through the use of the <code>elog</code>, <code>ewarn</code> and <code>eerror</code> functions.
These methods are used by the developers to notify the administrator
about something useful or important (usually <code>elog</code>), a potential issue
that might occur (<code>ewarn</code>) or even a problem that was found (<code>eerror</code>).
Let's look at a snippet of the <code>app-admin/eselect-postgresql-1.0.10</code>
package:</p>
<div class="highlight"><pre><span></span><code>pkg_postinst() {
    ewarn &quot;If you are updating from app-admin/eselect-postgresql-0.4 or older, run:&quot;
    ewarn
    ewarn &quot;    eselect postgresql update&quot;
    ewarn
    ewarn &quot;To get your system in a proper state.&quot;
    elog &quot;You should set your desired PostgreSQL slot:&quot;
    elog &quot;    eselect postgresql list&quot;
    elog &quot;    eselect postgresql set &quot;
}
</code></pre></div>


<p>Here, the developer warns the administrator that, if an upgrade of the
package from version 0.4 or older occurred, an additional action needs
to be taken. For others, he informs the administrators how to mark the
proper active PostgreSQL slot (using the <code>elog</code> methods).</p>
<p>Portage will save this information by default in <code>/var/log/portage/elog</code>
as separate files for each deployment:</p>
<div class="highlight"><pre><span></span><code>~$ ls /var/log/portage/elog/*eselect-postgres*
/var/log/portage/elog/app-admin:eselect-postgresql-1.0.10:20130818-184756.log
/var/log/portage/elog/app-admin:eselect-postgresql-1.2.0:20130915-131631.log
/var/log/portage/elog/app-admin:eselect-postgresql-1.2.0:20130915-200851.log
</code></pre></div>


<p>If <code>FEATURES="split-elog"</code> is set in your <code>make.conf</code> file, then the
elog files will be stored in separate category subdirectories. Below is
the content of such a single file:</p>
<div class="highlight"><pre><span></span><code>~$ cat /var/log/portage/elog/app-admin\:eselect-postgresql-1.0.10\:20130818-184756.log
INFO: setup
Package:    app-admin/eselect-postgresql-1.0.10
Repository: gentoo
Maintainer: titanofold@gentoo.org postgresql
USE:        abi_x86_64 amd64 elibc_glibc kernel_linux multilib selinux userland_GNU
FEATURES:   preserve-libs sandbox selinux sesandbox
WARN: postinst
If you are updating from app-admin/eselect-postgresql-0.4 or older, run:

    eselect postgresql update

To get your system in a proper state.
LOG: postinst
You should set your desired PostgreSQL slot:
    eselect postgresql list
    eselect postgresql set &lt;slot&gt;
</code></pre></div>


<p>In the file, package information is provided, and each set of logging
paragraphs is accompanied with information where in the build process
the logging came up. For instance, <code>WARN: postinst</code> sais that the
following text is through the <code>ewarn</code> method in the post install phase
of the package installation process.</p>
<p>By default Portage logs this, but you can ask it to mail the logs as
well. For more information about that, check the handbook link earlier
and look for the <code>PORTAGE_ELOG_SYSTEM</code> and <code>PORTAGE_ELOG_MAIL*</code>
variables. Or look at <strong>man make.conf</strong> which also contains all the
information needed.</p>
<p>Now, this only pertains to the specific logging that ebuild maintainers
added in the packages. But what if you want to keep track of all the
build logs? In that case, you need to define <code>PORT_LOGDIR</code> in your
<code>make.conf</code> file. This variable has to point to a location where Portage
(which usually runs as the <code>portage</code> Linux user) has write access to and
where it is allowed to store the build logs:</p>
<div class="highlight"><pre><span></span><code>~$ grep PORT_LOGDIR /etc/portage/make.conf 
PORT_LOGDIR=&quot;/var/log/portage&quot;
~$ ls -ldZ /var/log/portage/
drwxrwsr-x. 3 portage portage system_u:object_r:portage_log_t 679936 Sep 24 13:12 /var/log/portage/
</code></pre></div>


<p>With the variable set, build logs will be provided for each emerge (and
unmerge) operation of the package. These logs contain everything shown
on the terminal during a build process. Of course, this directory will
grow considerably in size so it is wise to properly handle old log
files. You can use logrotate for this, or just a single cronjob that
cleans up log files older than say 6 months. But Portage also provides
this functionality. If you set <code>FEATURES="clean-logs"</code> in your
<code>make.conf</code> file, then all log files older than 7 days will be removed
from the system. You can fine-tune this by setting <code>PORT_LOGDIR_CLEAN</code>
to the command you want executed. Its default value can be found in the
<code>/usr/share/portage/config/make.globals</code> file.</p>
<p>If you set <code>PORT_LOGDIR</code>, be aware that the elog files (described at the
beginning) will be stored in <code>${PORT_LOGDIR}/elog</code>. Similar to the
elogging, build logging can also be done in category subdirectories. If
<code>FEATURES="split-log"</code> is set, the build logs will be stored in
<code>${PORT_LOGDIR}/build/&lt;category&gt;</code> instead of <code>${PORT_LOGDIR}</code> directly.</p>
<p>Hopefully this post brings some users closer to this nice feature of
Portage.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'underestimated-or-underused-portage-elogging';
                var disqus_url = 'http://blog.siphos.be/2013/09/underestimated-or-underused-portage-elogging/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://www.gentoo.org" target="_blank">
                Gentoo Linux
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2018 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>