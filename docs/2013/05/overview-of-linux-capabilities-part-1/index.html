<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Overview of Linux capabilities, part 1 - Simplicity is a form of art...</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://blog.siphos.be/2013/05/overview-of-linux-capabilities-part-1/">

        <meta name="author" content="Sven Vermeulen" />
        <meta name="keywords" content="capabilities,linux" />
        <meta name="description" content="In the previous posts, I talked about capabilities and how they can be used to allow processes to run in a privileged fashion without granting them full root access to the system. An example given was how capabilities can be leveraged to run ping without granting it setuid root rights …" />

        <meta property="og:site_name" content="Simplicity is a form of art..." />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Overview of Linux capabilities, part 1"/>
        <meta property="og:url" content="https://blog.siphos.be/2013/05/overview-of-linux-capabilities-part-1/"/>
        <meta property="og:description" content="In the previous posts, I talked about capabilities and how they can be used to allow processes to run in a privileged fashion without granting them full root access to the system. An example given was how capabilities can be leveraged to run ping without granting it setuid root rights …"/>
        <meta property="article:published_time" content="2013-05-04" />
            <meta property="article:section" content="Security" />
            <meta property="article:tag" content="capabilities" />
            <meta property="article:tag" content="linux" />
            <meta property="article:author" content="Sven Vermeulen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://blog.siphos.be/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://blog.siphos.be/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blog.siphos.be/theme/css/pygments/native.css" rel="stylesheet">
    <link href="https://blog.siphos.be/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blog.siphos.be/theme/css/style.css" type="text/css"/>

        <link href="https://blog.siphos.be/feed/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... ATOM Feed"/>

        <link href="https://blog.siphos.be/feed/all.rss.xml" type="application/rss+xml" rel="alternate"
              title="Simplicity is a form of art... RSS Feed"/>


        <link href="https://blog.siphos.be/category/security/feed/atom.xml" type="application/atom+xml" rel="alternate"
              title="Simplicity is a form of art... Security ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://blog.siphos.be/" class="navbar-brand">
Simplicity is a form of art...            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="https://blog.siphos.be/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://blog.siphos.be/2013/05/overview-of-linux-capabilities-part-1/"
                       rel="bookmark"
                       title="Permalink to Overview of Linux capabilities, part 1">
                        Overview of Linux capabilities, part 1
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2013-05-04T03:50:00+02:00"> Sat 04 May 2013</time>
    </span>


            <span class="label label-default">By</span>
            <a href="https://blog.siphos.be/pages/about.html"><i class="fa fa-user"></i> Sven Vermeulen</a>

        <span class="label label-default">Category</span>
        <a href="https://blog.siphos.be/category/security.html">Security</a>


<span class="label label-default">Tags</span>
	<a href="https://blog.siphos.be/tag/capabilities/">capabilities</a>
        /
	<a href="https://blog.siphos.be/tag/linux/">linux</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>In the
<a href="http://blog.siphos.be/2013/05/capabilities-a-short-intro/">previous</a>
<a href="http://blog.siphos.be/2013/05/restricting-and-granting-capabilities/">posts</a>,
I talked about capabilities and how they can be used to allow processes
to run in a privileged fashion without granting them full root access to
the system. An example given was how capabilities can be leveraged to
run <strong>ping</strong> without granting it setuid root rights. But what are the
various capabilities that Linux is, well, capable of?</p>
<p>There are many, and as time goes by, more capabilities are added to the
set. The last capability added to the main Linux kernel tree was the
<code>CAP_BLOCK_SUSPEND</code> in the 3.5 series. An overview of all capabilities
can be seen with <strong>man capabilities</strong> or by looking at the Linux kernel
source code, <code>include/uapi/linux/capability.h</code>. But because you are all
lazy, and because it is a good exercise for myself, I'll go through many
of them in this and the next few posts.</p>
<p>For now, let's look at file related capabilities. As a reminder, if you
want to know which SELinux domains are "granted" a particular
capability, you can look this up using <strong>sesearch</strong>. The capability is
either in the <em>capability</em> or <em>capability2</em> class, and is named after
the capability itself, without the <code>CAP_</code> prefix:</p>
<div class="highlight"><pre><span></span><code>$ sesearch -c capability -p chown -A
</code></pre></div>


<dl>
<dt>CAP_CHOWN</dt>
<dd>Allow making changes to the file UIDs and GIDs.</dd>
<dt>CAP_DAC_OVERRIDE</dt>
<dd>Bypass file read, write and execute permission checks. I came across
a <a href="http://www.reddit.com/r/linux/comments/1cnn15/for_chmod_why_is_root_allowed_to_execute_programs/">reddit
post</a>
that was about this capability not that long ago.</dd>
<dt>CAP_DAC_READ_SEARCH</dt>
<dd>Bypass file read permission and directory read/search
permission checks.</dd>
<dt>CAP_FOWNER</dt>
<dd>This capability governs 5 capabilities in one:
</p>
-   Bypass permission checks on operations that normally require the
    file system UID of the process to match the UID of the file
    (unless already granted through <code>CAP_DAC_READ_SEARCH</code> and/or
    <code>CAP_DAC_OVERRIDE</code>)
-   Allow to set extended file attributes
-   Allow to set access control lists
-   Ignore directory sticky bit on file deletion
-   Allow specifying <code>O_NOATIME</code> for files in <em>open()</em> and <em>fnctl()</em>
    calls</dd>
<dt>CAP_FSETID</dt>
<dd>Do not clear the setuid/setgid permission bits when a file is
modified</dd>
<dt>CAP_LEASE</dt>
<dd>Allow establishing leases on files</dd>
<dt>CAP_LINUX_IMMUTABLE</dt>
<dd>Allow setting <em>FS_APPEND_FL</em> and <em>FP_IMMUTABLE_FL</em> inode flags</dd>
<dt>CAP_MKNOD</dt>
<dd>Allow creating special files with <strong>mknod</strong></dd>
<dt>CAP_SETFCAP</dt>
<dd>Allow setting file capabilities (what I did with the <strong>anotherping</strong>
binary in the previous post)</dd>
</dl>
<p>When working with SELinux (especially when writing applications), you'll
find that the <code>CAP_DAC_READ_SEARCH</code> and <code>CAP_DAC_OVERRIDE</code> capability
come up often. This is the case when applications are written to run as
root yet want to scan through, read or even execute non-root owned
files. Without SELinux, because these run as root, this is all granted.
However, when you start confining those applications, it becomes
apparent that they require this capability. Another example is when you
run user applications, as root, like when trying to play a movie or
music file with <strong>mplayer</strong> when this file is owned by a regular user:</p>
<div class="highlight"><pre><span></span><code>type=AVC msg=audit(1367145131.860:18785): avc:  denied  { dac_read_search } for
pid=8153 comm=&quot;mplayer&quot; capability=2  scontext=staff_u:sysadm_r:mplayer_t
tcontext=staff_u:sysadm_r:mplayer_t tclass=capability

type=AVC msg=audit(1367145131.860:18785): avc:  denied  { dac_override } for
pid=8153 comm=&quot;mplayer&quot; capability=1  scontext=staff_u:sysadm_r:mplayer_t
tcontext=staff_u:sysadm_r:mplayer_t tclass=capability
</code></pre></div>


<p>Notice the time stamp: both checks are triggered at the same time. What
happens is that the Linux security hooks first check for
<code>DAC_READ_SEARCH</code> (the "lesser" grants of the two) and then for
<code>DAC_OVERRIDE</code> (which contains <code>DAC_READ_SEARCH</code> and more). In both
cases, the check failed in the above example.</p>
<p>The <code>CAP_LEASE</code> capability is one that I had not heard about before
(actually, I had not heard of getting "file leases" on Linux either). A
file lease allows for the lease holder (which requires this capability)
to be notified when another process tries to open or truncate the file.
When that happens, the call itself is blocked and the lease holder is
notified (usually using SIGIO) about the access. It is not really to
lock a file (since, if the lease holder doesn't properly release it, it
is forcefully "broken" and the other process can continue its work) but
rather to properly close the file descriptor or flushing caches, etc.</p>
<p>BTW, on my system, only 5 SELinux domains hold the <em>lease</em> capability.</p>
<p>There are 37 capabilities known by the Linux kernel at this time. The
above list has 9 file related ones. So perhaps next I can talk about
process capabilities.</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <p>
        To comment as a guest, use "Or sign up with disqus" and then select the "I'd rather post as guest" option.
        </p>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

                    var disqus_identifier = 'overview-of-linux-capabilities-part-1';
                var disqus_url = 'https://blog.siphos.be/2013/05/overview-of-linux-capabilities-part-1/';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://github.com/sjvermeu"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="https://twitter.com/sjvermeu"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://www.gentoo.org" target="_blank">
                Gentoo Linux
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2020 Sven Vermeulen
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://blog.siphos.be/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://blog.siphos.be/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://blog.siphos.be/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'simplicityisaformofart'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>